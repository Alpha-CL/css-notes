# Formatting context

#### Block Formatting Contexts

> 块级格式化上下文是一块独立的渲染区域，规定了在该区域中，常规流块盒的布局

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


// 格式化上下文是 W3C CSS2.1 规范中 '块渲染区域' 规则，它决定了其子元素该如何定位

1) body root

2) float:not( none ){ left, right }

3) poisiton { absolute, fixed }

4) display { inline-block, table-cell, flex }

5) overflow:not( visible ) { hidden, auto, scroll }


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```


#### normal flow

> 所有元素，默认情况下，都属于常规流布局
> 常规流中，元素按照其在 HTML 中的先后位置至上而下布局
> 行内元素水平排列，直到当行被占满然后换行，块级元素则会被渲染为完整的一个新行

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * parent-block && containing-block: display: block;
 * 
 * containing-block == child-contain-block;
 * 
 * containing-block( 包含块 ): 每个盒模型的 '内容区' 为其所有子元素的 '包含块'
 * 
 *                            包含块的高度默认跟随 内容的多少 确定
 */


     * parent block                          parent - margin                                                            
+ ------------------------------------------------------------------------------------------------------------------- +
|                                            parent - border                                                          |
|   + ----------------------------------------------------------------------------------------------------------- +   |
|   |                                        parent - padding                                                     |   |
|   |   + --------------------------------------------------------------------------------------------------- +   |   |
|   |   | \\\ * containing block \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   | \\ + ----------------------------- child - margin -------------------------------------------- + \\ |   |   |
|   |   | \\ | +---------------------------- child - border -------------------------------------------+ | \\ |   |   |
|   |   | \\ | | + ------------------------- child - padding ----------------------------------------+ | | \\ |   |   |
|   |   | \\ | | |                                                                                   | | | \\ |   |   |
|   |   | \\ | | | child containing block |<---------- width:auto; > margin:auto; ---------------->| | | | \\ |   |   |
|   |   | \\ | | | |<--------------------------------- unset width => width: auto;---------------->| | | | \\ |   |   |
|   |   | \\ | | | set fix width |<------------------- margin-right: auto;------------------------>| | | | \\ |   |   |
|   |   | \\ | | |                                                                                   | | | \\ |   |   |
|   |   | \\ | | + ----------------------------------------------------------------------------------+ | | \\ |   |   |
|   |   | \\ | +---------------------------------------------------------------------------------------+ | \\ |   |   |
|   |   | \\ + ----------------------------------------------------------------------------------------- + \\ |   |   |
|   |   | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   + --------------------------------------------------------------------------------------------------- +   |   |
|   |                                                                                                             |   |
|   + ----------------------------------------------------------------------------------------------------------- +   |
|                                                                                                                     |
+ ------------------------------------------------------------------------------------------------------------------- +


<div class="parent-block">

    <div class="child-block"></div>
    
</div>



1) 每个块盒子的总宽度(宽度 + 边距*2 + 内边距*2 +  外边距*2 )必须等于包含块的内容宽度
    
    * containing-block = parent-block.content[width] 
    
    = child-block[width] + child-block[padding-width]*2 + child-block[border-width]*2 + child-block[margin-width]*2;


2) 默认情况 child-block 的 width: auto; margin: auto;, child-block 的 width 自动吸收并占据 parent-block 内容区的宽度

   来满足'盒模型独占一行'的形式


    * width: auto; 权重 比 margin: auto; 的权重大，所以默认 width: auto; 吸收并占据 parent-block 内容区宽度
    
    if ( unset child-block[width] ) {                  
    
        child-block[margin] = 0;
        
        child-block[width] == parent-block.content[width];     // child-block[width] 吸收并占据 parent-block 内容区宽度 
    }


3) 若设置 child-block 宽度为固定值，margin-right 自动吸收并占据 child-block 与 parent-block 之间所剩宽度
    
    * 当设置 child-block[width, pading, border, margin]后，仍有剩余空间，则该剩余空间被 margin-right 全部吸收并占据
    
        * 因 html 文档的文本排列是从左到右，则是 margin-right 吸收( 可以改变文本排列方向，即可改变为 margin-left 吸收剩余块度 )

    if ( set child-block[width] = fix-value ) {
    
        child-block[width] = fix-value;

        child-block[margin-right] = parent-block[width] - child-block[width];
    }
        
    * 若 child-block[width]: auto;( 默认)  margin-left: -100px; margin-right: -100px; , 
    
      则 margin-left & margin-right 可以吸收父容器以外的横向距离


4) containing-block 的高度默认由 child-block 内容的多少决定

    * margin 垂直方向的高度 默认为 auto == 0; ( margin-top: auto; margin-bottom: auto; )


5) child-block 设置 'width, padding, margin' 的属性值为百分比值时  都是相对于 "其父级的'宽度'" 值进行计算

    * 当 parent-block[height] 由 child-block[height] 撑开时，设置 child-block[height] = num%; 无效
    
    * 当 parent-block[height] 有固定值时，设置 child-block[height] = num%; 有效


6) 常规流块盒上下外边距合并: 两个常规流块盒，上下外边距'相邻'时，margin 会合并( 仅较大 margin 值有效 ), 无论兄弟元素还是父子元素
   ( 仅在常规流中出现 )
                          margin-top + margin-top || margin-top + margin-bottom

   * 来源于印刷术的外边距合并


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### float

> 在浮动布局中，元素首先按照普通流的位置出现，然后根据浮动的方向尽可能的向左边或右边偏移
> 
> 使用浮动有时候是为了获得更好的兼容性
> 
> 只有脱离了常规流的元素，才可设置 z-index

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


     * parent block                                  parent - margin                                                    
+ ------------------------------------------------------------------------------------------------------------------- +
|                                                    parent - border                                                  |
|   + ----------------------------------------------------------------------------------------------------------- +   |
|   |                                                parent - padding                                             |   |
|   |   + --------------------------------------------------------------------------------------------------- +   |   |
|   |   | + ---------------------------------------- normal - flow - block -------------------------------- + |   |   |
|   |   | | /////////////////////////////////////////////////////////////////////////////////////////////// | |   |   |
|   |   | | ///////////////////////////////////////// before painter ////////////////////////////////////// | |   |   |
|   |   | | /////////////////////////////////////////////////////////////////////////////////////////////// | |   |   |
|   |   | | /////////////////////////////////////////////////////////////////////////////////////////////// | |   |   |
|   |   | + ----------------------------------------------------------------------------------------------- + |   |   |
|   |   | + -- display: block -- + ------------ + \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ + -- display: block -- + |   |   |
|   |   | | \\\\\\\\\\\\\\\\\\\\ | //////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ | \\\\\\\\\\\\\\\\\\\\ | |   |   |
|   |   | | \\\ next painter \\\ | //////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ | \\\ next painter \\\ | |   |   |
|   |   | | \\\\\\\\\\\\\\\\\\\\ | //////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ | \\\\\\\\\\\\\\\\\\\\ | |   |   |
|   |   | | \\\ float - left \\\ | //////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ | \\ float - right \\\ | |   |   |
|   |   | | \\\\\\\\\\\\\\\\\\\\ | //////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ | \\\\\\\\\\\\\\\\\\\\ | |   |   |
|   |   | | \\\ z-index: 1; \\\\ | //////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ | \\ z-index: 1; \\\\\ | |   |   |
|   |   | | \\\\\\\\\\\\\\\\\\\\ | //////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ | \\\\\\\\\\\\\\\\\\\\ | |   |   |
|   |   | + -------------------- + //////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ + -------------------- + |   |   |
|   |   | | /////////////////////////////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   | | //// after painter //////////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   | | /////////////////////////////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   | | //// z-index: 0; ////////////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   | | /////////////////////////////////// | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   | + ---- normal - flow - block -------- + \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   | \\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\\ |   |   |
|   |   + --------------------------------------------------------------------------------------------------- +   |   |
|   |                                                                                                             |   |
|   + ----------------------------------------------------------------------------------------------------------- +   |
|                                                                                                                     |
+ ------------------------------------------------------------------------------------------------------------------- +

    * 浮动元素会先按照 常规流 水平方向排列，再按照 浮动原则排列


<div class="parent-block">

    <div class="normal-flow-block"></div>
    
    <div class="float-left" style="float: left;"></div>                 // 理论上: z-index: 1;
    <div class="float-right" style="float: right;"></div>               // 理论上: z-index: 1;

    <div class="normal-flow-block"></div>                               // 理论上: z-index: 0;
    
</div>


1) 浮动后会隐式将当前元素转换为 display: block;

2) 浮动元素的包含块和常规流的一样

3) 盒子尺寸: 当 width: auto; 时，自适应内容宽度
            当 height: auto; 时，自适应内容高度

4) 设置浮动元素的 'width, padding, margin' 的属性值为百分比值时  都是相对于 "其父级的'宽度'" 值进行计算        

5) 盒子排列: 默认跟随设置方向排列 float: left: || float: right;

            当浮动元素与常规流元素同时排列时:                       // 无法通过 z-index 改变其绘制层级
            
            1> 若先绘制的常规流元素，则浮动元素会避让常规流元素
            
            2> 若后绘制的常规流元素，则浮动元素会在常规流元素的上方层叠( 可能会覆盖部分或全部常规流元素的区域 )


6) 图文环绕: 当设置元素为 inline-block 时，inline-block 会跟文字以基线对齐

            当设置元素为 float: left/right 时; 若 文字 不在 inline 元素中，
            则浏览器会隐式给 <div class="anonymous-inline-block" style="display: inline-block;">文字</div>


7) 高度坍塌: 当给子元素 设置 float 时，父级常规流元素计算高度时 会忽略 浮动元素的高度
            
8) 解决高度坍塌: .clearfix::after {
                    content: "";
                    clear: both;
                    display: block;
               }


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### position

> 手动控制元素在包含块中的精确位置
> 
> 脱离文档流的定位元素，无法被包裹块获取高度，并设置自适应高度
> 
> 只有脱离了常规流的元素，才可设置 z-index

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * position: static( default ) | relative | absolute | fixed;
 * 
 * @static( default ): 默认常规流
 * 
 * @relative: 相对定位
 * 
 * @absolute: 绝对定位
 * 
 * @fixed:    固定定位
 * 
 * @params:not(static, relative): 属于脱离文档流对元素的 '定位元素'，常规流排列时，会忽略脱离文档流定位元素所产生的影响
 * 
 * 脱离文档流对元素的 '定位元素': 隐式转换为 display: block;
 */


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * parents-block[ position: static ]
 * 
 * child-block[ position: relative ]
 * 
 * 
 * 不会导致元素脱离文档流，会使元素在原有位置上进行偏移
 * 
 * 与常规流元素混合排列时: 不影响常规流元素
 */


body,
.parent-block {
    position: relative;
    width: 100px;
    height: 100px;
    top: 50%;
    left:  50%;
    tranform: translate(-50%, -50%);
}


     * parent block( position: static; )                            // normal flow element                               
+ ------------------------------------------------------------------------------------------------------------------- +
| /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// |
| // + --------------------------------------------------------- parent containing block ----------------------- + // |
| // | + ---- current site ---- +  -                                                                             | // |
| // | |                        |  |                                                                             | // |
| // | |  position: relative;   |  |                                                                             | // |
| // | |                        | top                                                                            | // |
| // | |                        |  |                                                                             | // |
| // | |                        |  |                                                                             | // |
| // | + ---------------------- +  |                                                                             | // |
| // |                             -                                                                             | // |
| // | |<------ left: num; ----->| + ------ after site ------- +                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             | // position: relative; // |                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             + ------------------------- +                                                 | // |
| // |                                                                                                           | // |
| // |                                                                                                           | // |
| // |                                                                                                           | // |
| // + --------------------------------------------------------------------------------------------------------- + // |
| /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// |
+ ------------------------------------------------------------------------------------------------------------------- +


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * parents-blocks:first-nth-type( position:not(static, relative){ ... } )
 * 
 * child-block[ position: absolute ]
 * 
 * 
 * 相对于祖先元素中 '第一个定位元素' 的包含块位置偏移
 * 
 * 与常规流元素混合排列时: 不影响常规流元素
 */


body,
.parent-block {
    position: relative;
}

.site-center-middle {
    position: absolte;
    width: 100px;
    height: 100px;
    top: 50%;
    left:  50%;
    tranform: translate(-50%, -50%);
}


     * parent block( position:not( static, relative ){ ... } );      // positioned element                        
+ ------------------------------------------------------------------------------------------------------------------- +
| /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// |
| // + --------------------------------------------------------- parent containing block ----------------------- + // |
| // | + - - current site - - - +  -                                                                             | // |
| // | |                        |  |                                                                             | // |
| // | |  position: absolute;   |  |                                                                             | // |
| // | |                        | top                                                                            | // |
| // | |                        |  |                                                                             | // |
| // | + - - - - - - - - - - - -+  |                                                                             | // |
| // |                             -                                                                             | // |
| // | |<------ left: num; ----->| + ------ after site ------- +                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             | // position: absolute; // |                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             + ------------------------- +                                                 | // |
| // |                                                                                                           | // |
| // |                                                                                                           | // |
| // |                                                                                                           | // |
| // + --------------------------------------------------------------------------------------------------------- + // |
| /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// |
+ ------------------------------------------------------------------------------------------------------------------- +


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * parents-block( window.screen )                           // 因相对于 视口，所以可以设置 height: 100%;
 * 
 * child-block[ position: fixed ]
 * 
 * 与常规流元素混合排列时: 不影响常规流元素
 */


.site-center-middle {
    margin: auto
    position: fixed;
    width: 100px;
    height: 100px;
    left: 0;
    right: 0;
    top: 0;
    bottom: 0;
}

.site-center-middle {
    position: fixed;
    width: 100px;
    height: 100px;
    top: 50%;
    left:  50%;
    tranform: translate(-50%, -50%);
}


     * parent block( browser viewport )                              // browser-viewport                
+ ------------------------------------------------------------------------------------------------------------------- +
| /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// |
| // + --------------------------------------------------------- parent containing block ----------------------- + // |
| // | + - - current site - - - +  -                                                                             | // |
| // | |                        |  |                                                                             | // |
| // | |    position: fixed;    |  |                                                                             | // |
| // | |                        | top                                                                            | // |
| // | |                        |  |                                                                             | // |
| // | |                        |  |                                                                             | // |
| // | + - - - - - - - - - - - -+  |                                                                             | // |
| // |                             -                                                                             | // |
| // | |<------ left: num; ----->| + ------ after site ------- +                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             | /// position: fixed; //// |                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             | ///////////////////////// |                                                 | // |
| // |                             + ------------------------- +                                                 | // |
| // |                                                                                                           | // |
| // |                                                                                                           | // |
| // |                                                                                                           | // |
| // + --------------------------------------------------------------------------------------------------------- + // |
| /////////////////////////////////////////////////////////////////////////////////////////////////////////////////// |
+ ------------------------------------------------------------------------------------------------------------------- +


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### stack content

> 堆叠上下文: 指在同一区域内，不同元素在 Z轴 上相互叠加的情况

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


    /**
     * z-index: level: number;
     * 
     * 仅在脱离文档流的定位元素上使用才会生效
     * 
     * 数值越大所属层级越高，层级最大的属于展示层，其余会根据层级覆盖在展示层之下            // PS 中图层的概念
     */

          * painter-(order: num);

    + -------------- current element paint layer -------------------------------------- +       
    |                                                                                   |         
    |                                                                                   |  
    |                                                                                   |  
    |                                                  z-inde:                          |    
    |                                                  0 | auto;                        |  
    |                                                                                   |  
    |                                                 /|                                |  
    |                                                  | y-axis                         |
    |                                                  |                                |  
    |                                                  |                                |  
    |          +index   index0                         |     -index  bg & bdr           |  
    |                                                  |                                |  
    |   valid    |      float                          |        |      |                |  
    |                                                  |                                |
    |            |      |                              |        |      |                |  
    |                           z-inde: 0 | auto;      |                                |  
    |   invalid  |      |       |-------------|        |        |      |                |  
    |                                                  |                                |  
    |            |      |       inline-text            |        |      |                |  
    |                                                  |                                |
    |            |      |       |      inline-block    |        |      |                | 
    |                                                  |                                |
    |            |      |       |      |      block    |        |      |                |
    |                                                  |                                |
    |            |      |       |      |      |        |        |      |                |
    |                                                  |                                |
    |            |      |       |      |      |        |        |      |                |
    |    <------ + ---- + ----- + ---- + ---- + ------ + ------ + ---- + ------------   |
    |     z-axis |      |       |      |      |        |        |      |                |
    |                                                  |                                |
    |            |      |       |      |      |        |        |      |                |
    |                                                  |                                |
    |            +      +       +      +      +        |        +      +                |
    |                                                                                   |
    |   order   (5)    (4)     (3)    (3)    (3)      (3)      (2)    (1)               |
    |                                                                                   |            
    |                                                                                   |            
    + --------------------------------------------------------------------------------- +
            

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```

#### layer example

``` javascript
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


/**
 * 伪等高
 * 
 * 解决侧边栏跟随内容高度自适应
 */

.aside {
    height: 10000px;
    margin-bottom: 9990px;
    over-flow: hidden;
}


//-------------------------------------------------------------------------------------------------------------------//


/**
 * inline, inline-block horizontal align
 * 
 * 
 */

.inline-container,
.inline-block-container {
    text-align: center;
}


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * normal-flow block horizontal align
 * 
 * 
 */

.nornal-flow-block-container {
    margin: 0 auto;
}

.nornal-flow-block {
    width: fix-value;                   // must condition
}


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * absolute element horizontal align
 * 
 * 
 */


.relative-element-container {
    position: relative;
}

.absolute-element {
    position: absolute;
    width: fix-value;                   // must condition
    left: 0;
    right: 0;
    margin: 0 auto;
}


//-------------------------------------------------------------------------------------------------------------------//


/**
 * single line of text vertical align
 * 
 * 
 */

.single-line-text {
    height: fix-value;
    line-height: fix-value;
}


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * multi-line of text vertical align
 * 
 * inline-block || block 中 多行文本垂直居中                 // 此方法无法设置固定高度
 */


.multi-line-text {
    padding: fix-value 0;
}


//- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -//


/**
 * absolute element vertical align
 * 
 * 
 */


.relative-element-container {
    position: relative;
}

.absolute-element {
    position: absolute;
    hieght: fix-value;              // must condition
    top: 0;
    bottom: 0;
    margin: auto 0;
}


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
```


